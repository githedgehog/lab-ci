set shell := ["bash", "-euo", "pipefail", "-c"]

update-diagrams:
	@echo "==============================================="
	@echo "Updating diagrams for env-ci-1.l"
	@echo "==============================================="

	@echo "Generating diagrams for env-ci-1.l: spine-leaf"
	mkdir -p env-ci-1.l/diagrams/spine-leaf
	hhfab init --dev -f -w env-ci-1.l/wiring.yaml
	hhfab diagram --format drawio --style default --output env-ci-1.l/diagrams/spine-leaf/env-ci-1-spine-leaf.drawio
	hhfab diagram --format dot    --output env-ci-1.l/diagrams/spine-leaf/env-ci-1-spine-leaf.dot
	hhfab diagram --format mermaid --output env-ci-1.l/diagrams/spine-leaf/env-ci-1-spine-leaf.mermaid
	if command -v dot >/dev/null; then dot -Tpng env-ci-1.l/diagrams/spine-leaf/env-ci-1-spine-leaf.dot -o env-ci-1.l/diagrams/spine-leaf/env-ci-1-spine-leaf.dot.png; fi
	if command -v drawio >/dev/null; then drawio --export --format png --output env-ci-1.l/diagrams/spine-leaf/env-ci-1-spine-leaf.drawio.png env-ci-1.l/diagrams/spine-leaf/env-ci-1-spine-leaf.drawio; fi
	if command -v mmdc >/dev/null; then mmdc -i env-ci-1.l/diagrams/spine-leaf/env-ci-1-spine-leaf.mermaid -o env-ci-1.l/diagrams/spine-leaf/env-ci-1-spine-leaf-mermaid.png; fi

	@echo ""
	@echo "All diagrams updated for env-ci-1.l"
	@echo "Updated files in env-ci-1.l/diagrams/spine-leaf/:"
	@echo "- Source files: env-ci-1-spine-leaf.{drawio,dot,mermaid}"
	@echo "- PNG files: env-ci-1-spine-leaf.{dot.png,drawio.png,*-mermaid.png}"

default: update-diagrams
